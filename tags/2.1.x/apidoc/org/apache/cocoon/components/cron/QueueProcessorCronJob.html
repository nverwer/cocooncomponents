<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="nl">
<head>
<!-- Generated by javadoc (version 1.7.0_45) on Fri Jul 11 12:39:05 CEST 2014 -->
<title>QueueProcessorCronJob (Cocoon components)</title>
<meta name="date" content="2014-07-11">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="QueueProcessorCronJob (Cocoon components)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/QueueProcessorCronJob.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/cocoon/components/cron/QueueAddJob.html" title="class in org.apache.cocoon.components.cron"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.JobConfig.html" title="class in org.apache.cocoon.components.cron"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/cocoon/components/cron/QueueProcessorCronJob.html" target="_top">Frames</a></li>
<li><a href="QueueProcessorCronJob.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.cocoon.components.cron</div>
<h2 title="Class QueueProcessorCronJob" class="title">Class QueueProcessorCronJob</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>ServiceableCronJob</li>
<li>
<ul class="inheritance">
<li>org.apache.cocoon.components.cron.QueueProcessorCronJob</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="strong">QueueProcessorCronJob</span>
extends ServiceableCronJob</pre>
<div class="block">Execute jobs that are submitted to a queue.

 <p>
 A queue is a directory on disk that contains jobs-to-be-executed in the "in"
 subdirectory.
 <p>
 A job is a XML file containing meta-data describing the job and one or more
 subtasks that are part of the job. A task contains a URL that is
 'resolved' when the task is executed. The output of the URL ends up in a
 task-results.txt file. Note that tasks are executed *** in random order ***.
 <p>
 A queue has four directories: "in", "in-progress", "out" and "error". 1 - New
 jobs that are waiting to be processed are in "in". 2 - The one job that is
 being executed is in "in-progress". 3 - Finished jobs are zipped. Job-file and
 task-output files end up in "out". 4 - Jobs that could not be executed at all
 (or generated an error in this class)end up in "error".
 <p>
 Execute this object (a "Processor") every n (micro)seconds using a Cocoon
 Quartz job and it will process one job in a queue. Processing a job means
 moveing the job-*.xml file to "in-progress" and starting a separate thread
 for each task in the job, then waiting till all tasks have finished.
 <p>
 While executing, a Processor updates the file Queue/processor-status.xml
 every 10 seconds or so with the following info:
 <p>
 <pre>
 <code>&lt;processor id="thread-id" started="dateTime"
 tasks="nr of tasks" tasks-completed="nr of completed tasks" /&gt;
 </code>
 </pre>
 <p>
 This file can be read in order to get an idea of the progress of
 the current job. It also indicates whether the current job is being processed
 at all - if the modified timestamp of the file is older than, say, a minute,
 it is assumed the Processor/job has failed. However, when more than one
 QueueProcessorCronJob is allowed to run at the same time, this can go wrong if a
 task takes longer to complete than said minute. This is because the
 processor-status.xml file is only updated after a task has completed
 (successfully or not). It is therefore recommended to have the
 concurrent-runs="false" attribute on a Trigger.
 <p>
 When a Processor starts there are a few possible scenarios: 1 another job is
 already being processed and that Processor is still alive -> quit. 2 there is
 no job to be processed -> quit. 3 there is no other Processor running but
 there's a job already being processed -> move job to "error"-directory, quit.
 4 there is a job to be processed and no Processor active -> start processing
 a new job.
 <p>
 To submit a job, place a XML file called "job-{id}.xml" in the
 "in"-directory, containing the following structure:
 <p>
 <pre>
 <code>&lt;job id="..." name="test-job" description="..."
   created="20140613T11:45:00" max-concurrent="3"&gt;
    &lt;tasks&gt;
        &lt;task id="task-1"&gt;
           &lt;uri&gt;http://localhost:8888/koop/front/queue-test?id=1&lt;/uri&gt;
        &lt;/task&gt;
        ...
    &lt;/tasks&gt;
 &lt;/job&gt;
 </code>
 </pre>
 <p>
 The max-concurrent attribute can be positive or negative. When it is 
 positive it is the maximum number of concurrent threads but the actual 
 number of concurrent threads will never be higher than the number of
 available cores. When it is negative the number of threads used is the 
 number of available cores plus the max-concurrent attribute (resulting in a
 smaller number); but it is always at least one.
 <p>
 To add this cronjob to Cocoon add a trigger to the Quartzcomponent
 configuration and declare this component in the same sitemap.
 <p>
 <pre>
 <code>&lt;component
   class="org.apache.cocoon.components.cron.CocoonQuartzJobScheduler"
   logger="cron" role="org.apache.cocoon.components.cron.JobScheduler"&gt;
   .....
   &lt;trigger name="queueprocessor-job"
       target="org.apache.cocoon.components.cron.CronJob/queueprocessor"
       concurrent-runs="false"&gt;
       &lt;cron&gt;0/10 * * * * ?&lt;/cron&gt;
   &lt;/trigger&gt;
 &lt;/component&gt;
 </code>
 </pre>
 <p>
 and
 <p>
 <pre>
 <code>&lt;component class="org.apache.cocoon.components.cron.QueueProcessorCronJob"
   logger="cron.publish"
   role="org.apache.cocoon.components.cron.CronJob/queueprocessor"&gt;
    &lt;queue-path&gt;path-to-queue-directory-on-disk&lt;/queue-path&gt;
 &lt;/component&gt;
 </code>
 </pre>
 <p></div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested_class_summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.JobConfig.html" title="class in org.apache.cocoon.components.cron">QueueProcessorCronJob.JobConfig</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.JodaTimeConverter.html" title="class in org.apache.cocoon.components.cron">QueueProcessorCronJob.JodaTimeConverter</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.ProcessorStatus.html" title="enum in org.apache.cocoon.components.cron">QueueProcessorCronJob.ProcessorStatus</a></strong></code>
<div class="block">An enum denoting the status of a Processor this class).</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.Task.html" title="class in org.apache.cocoon.components.cron">QueueProcessorCronJob.Task</a></strong></code>
<div class="block">Classes used by XStream for loading the job-*.xml config files into.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.html#QueueProcessorCronJob()">QueueProcessorCronJob</a></strong>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.html#configure(Configuration)">configure</a></strong>(Configuration&nbsp;config)</code>
<div class="block">Get path to queue folder.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.html#execute(java.lang.String)">execute</a></strong>(java.lang.String&nbsp;name)</code>
<div class="block">Main entrypoint for CronJob.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>protected java.io.File</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.html#getOldestJobFile(java.io.File)">getOldestJobFile</a></strong>(java.io.File&nbsp;dir)</code>
<div class="block">Get oldest job (file named "job-*.xml") in dir, using lastModified
 timestamp and picking first File if there is more than one file with the
 same lastModified.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static XStream</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.html#getXStreamJobConfig()">getXStreamJobConfig</a></strong>()</code>
<div class="block">Set some XStream options to configure serialization.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.html#setup(Parameters, java.util.Map)">setup</a></strong>(Parameters&nbsp;params,
     java.util.Map&nbsp;objects)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="QueueProcessorCronJob()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>QueueProcessorCronJob</h4>
<pre>public&nbsp;QueueProcessorCronJob()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="execute(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>execute</h4>
<pre>public&nbsp;void&nbsp;execute(java.lang.String&nbsp;name)</pre>
<div class="block">Main entrypoint for CronJob.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>name</code> - </dd></dl>
</li>
</ul>
<a name="setup(Parameters, java.util.Map)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setup</h4>
<pre>public&nbsp;void&nbsp;setup(Parameters&nbsp;params,
         java.util.Map&nbsp;objects)</pre>
</li>
</ul>
<a name="configure(Configuration)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>configure</h4>
<pre>public&nbsp;void&nbsp;configure(Configuration&nbsp;config)
               throws ConfigurationException</pre>
<div class="block">Get path to queue folder.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>config</code> - </dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code>ConfigurationException</code></dd></dl>
</li>
</ul>
<a name="getOldestJobFile(java.io.File)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getOldestJobFile</h4>
<pre>protected&nbsp;java.io.File&nbsp;getOldestJobFile(java.io.File&nbsp;dir)</pre>
<div class="block">Get oldest job (file named "job-*.xml") in dir, using lastModified
 timestamp and picking first File if there is more than one file with the
 same lastModified.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>dir</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd></dd></dl>
</li>
</ul>
<a name="getXStreamJobConfig()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>getXStreamJobConfig</h4>
<pre>public static&nbsp;XStream&nbsp;getXStreamJobConfig()</pre>
<div class="block">Set some XStream options to configure serialization.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>The configured XStream object.</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/QueueProcessorCronJob.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../org/apache/cocoon/components/cron/QueueAddJob.html" title="class in org.apache.cocoon.components.cron"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../../org/apache/cocoon/components/cron/QueueProcessorCronJob.JobConfig.html" title="class in org.apache.cocoon.components.cron"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?org/apache/cocoon/components/cron/QueueProcessorCronJob.html" target="_top">Frames</a></li>
<li><a href="QueueProcessorCronJob.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested_class_summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><i>http://code.google.com/p/cocooncomponents/</i></small></p>
</body>
</html>
